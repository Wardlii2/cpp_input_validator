name: CI

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

jobs:
  cpp-build-and-test:
    runs-on: windows-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up MSVC
        uses: ilammy/msvc-dev-cmd@v1

      - name: Build tests (MSVC)
        shell: cmd
        run: |
          cl /EHsc cpp\input_validator_test.cpp /Fo:cpp\ /Fd:cpp\ /Fe:cpp\input_validator_test.exe
          cl /EHsc cpp\Parser_test.cpp /Fo:cpp\ /Fd:cpp\ /Fe:cpp\Parser_test.exe
          cl /EHsc cpp\Dispatcher_test.cpp /Fo:cpp\ /Fd:cpp\ /Fe:cpp\Dispatcher_test.exe
          cl /EHsc cpp\End_to_end_test.cpp cpp\app.cpp /Fo:cpp\ /Fd:cpp\ /Fe:cpp\End_to_end_test.exe

      - name: Run tests
        shell: cmd
        run: |
          cpp\input_validator_test.exe
          cpp\Parser_test.exe
          cpp\Dispatcher_test.exe
          cpp\End_to_end_test.exe

  python-tests:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.11"

      - name: Install pytest
        run: |
          python -m pip install --upgrade pip
          pip install pytest

      - name: Run tests
        working-directory: python
        run: pytest -q

  java-tests:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up Java
        uses: actions/setup-java@v4
        with:
          distribution: "temurin"
          java-version: "17"
          cache: "maven"

      - name: Run Maven tests
        working-directory: java
        run: mvn test
